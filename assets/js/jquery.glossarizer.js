!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports&&"function"==typeof require?e(require("jquery")):e(jQuery)}(function(e){"use strict";function t(t,s){var r=this;r.el=t,r.$el=e(t),r.options=e.extend({},i,s),r.terms=[],r.excludes=[],r.replaced=[],r.regexOption=(r.options.caseSensitive?"":"i")+(r.options.replaceOnce?"":"g"),e.getJSON(this.options.sourceURL).then(function(e){if(r.glossary=e,r.glossary.length&&0!=r.glossary.length){for(var t=0;t<r.glossary.length;t++)for(var s=r.glossary[t].terms.split(","),i=0;i<s.length;i++){var n=s[i].replace(/^\s+|\s+$/g,""),a=n.indexOf("!");-1==a||0!=a?r.terms.push(n):r.excludes.push(n.substr(1))}r.wrapTerms()}})}function s(t,s,r){if("string"!=typeof t)return e.inArray.apply(this,arguments);if(s){var i=s.length;for(r=r?r<0?Math.max(0,i+r):r:0,t=t.toLowerCase();r<i;r++)if(r in s&&s[r].toLowerCase()==t)return r}return-1}var r="glossarizer",i={sourceURL:"",replaceTag:"abbr",lookupTagName:"p, ul, a, div",callback:null,replaceOnce:!1,replaceClass:"glossarizer_replaced",caseSensitive:!1,exactMatch:!1};t.prototype={getDescription:function(e){for(var t=new RegExp("(,|s*)"+this.clean(e)+"\\s*|\\,$","i"),s=0;s<this.glossary.length;s++)if(this.options.exactMatch){if(this.glossary[s].terms==this.clean(e))return this.glossary[s].description.replace(/\"/gi,"&quot;")}else if(this.glossary[s].terms.match(t))return this.glossary[s].description.replace(/\"/gi,"&quot;")},clean:function(e){var t=new RegExp("(\\"+["/",".","*","+","?","(",")","[","]","{","}","\\"].join("|\\")+")","g");return e.replace(t,"\\$1")},wrapTerms:function(){this.cleanedTerms=this.clean(this.terms.join("|")),this.excludedTerms=this.clean(this.excludes.join("|"));for(var e=this.el.querySelectorAll(this.options.lookupTagName),t=0;t<e.length;t++)this.traverser(e[t]);this.options.callback&&this.options.callback.call(this.$el)},traverser:function(t){var r,i=this;if(1===t.nodeType){if(t=t.firstChild)do{r=t.nextSibling,t.className!=this.options.replaceClass&&this.traverser(t)}while(t=r)}else if(3===t.nodeType){var n=document.createElement("div"),a=t.data,o=new RegExp("(?:^|\\b)("+this.cleanedTerms+")(?!\\w)",i.regexOption),l=new RegExp("(?:^|\\b)("+this.excludedTerms+")(?!\\w)",i.regexOption);if(o.test(a)){var c=l.exec(a);for(a=a.replace(o,function(e,t,r){if(i.options.replaceOnce&&s(e,i.replaced)>=0)return e;if(i.replaced.push(e),new RegExp("(?:^|\\b)"+i.clean(e)+"(?!\\w)").exec(a)){if(c&&i.excludes.length){var n=r,o=c.index,l=c.index+c[0].length;return o<=n&&n<=l?e:"<"+i.options.replaceTag+' class="'+i.options.replaceClass+'" title="'+i.getDescription(e)+'">'+e+"</"+i.options.replaceTag+">"}return"<"+i.options.replaceTag+' class="'+i.options.replaceClass+'" title="'+i.getDescription(e)+'">'+e+"</"+i.options.replaceTag+">"}}),e(n).html(a);n.firstChild;)t.parentNode.insertBefore(n.firstChild,t);t.parentNode.removeChild(t)}}}};var n={destroy:function(){this.$el.removeData("plugin_"+r),this.$el.find("."+this.options.replaceClass).each(function(){var t=e(this),s=t.text();t.replaceWith(s)})}};t.prototype=e.extend({},t.prototype,n),e.fn[r]=function(s){return this.each(function(){var i=e(this).data("plugin_"+r);"string"==typeof s&&i&&n.hasOwnProperty(s)?i[s].apply(i):(i&&i.destroy.apply(i),e.data(this,"plugin_"+r,new t(this,s)))})}});