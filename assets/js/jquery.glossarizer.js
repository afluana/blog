!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports&&"function"==typeof require?e(require("jquery")):e(jQuery)}(function(e){"use strict";function t(t,r){var s=this;s.el=t,s.$el=e(t),s.options=e.extend({},i,r),s.terms=[],s.excludes=[],s.replaced=[],s.regexOption=(s.options.caseSensitive?"":"i")+(s.options.replaceOnce?"":"g"),e.getJSON(this.options.sourceURL).then(function(e){if(s.glossary=e,s.glossary.length&&0!=s.glossary.length){for(var t=0;t<s.glossary.length;t++)for(var r=s.glossary[t].term.split(","),i=0;i<r.length;i++){var n=r[i].replace(/^\s+|\s+$/g,""),a=n.indexOf("!");-1==a||0!=a?s.terms.push(n):s.excludes.push(n.substr(1))}s.wrapTerms()}})}function r(t,r,s){if("string"!=typeof t)return e.inArray.apply(this,arguments);if(r){var i=r.length;for(s=s?s<0?Math.max(0,i+s):s:0,t=t.toLowerCase();s<i;s++)if(s in r&&r[s].toLowerCase()==t)return s}return-1}var s="glossarizer",i={sourceURL:"",replaceTag:"abbr",lookupTagName:"p, ul, a, div",callback:null,replaceOnce:!1,replaceClass:"glossarizer_replaced",caseSensitive:!1,exactMatch:!1};t.prototype={getDescription:function(e){for(var t=new RegExp("(,|s*)"+this.clean(e)+"\\s*|\\,$","i"),r=0;r<this.glossary.length;r++)if(this.options.exactMatch){if(this.glossary[r].term==this.clean(e))return this.glossary[r].description.replace(/\"/gi,"&quot;")}else if(this.glossary[r].term.match(t))return this.glossary[r].description.replace(/\"/gi,"&quot;")},clean:function(e){var t=new RegExp("(\\"+["/",".","*","+","?","(",")","[","]","{","}","\\"].join("|\\")+")","g");return e.replace(t,"\\$1")},wrapTerms:function(){this.cleanedTerms=this.clean(this.terms.join("|")),this.excludedTerms=this.clean(this.excludes.join("|"));for(var e=this.el.querySelectorAll(this.options.lookupTagName),t=0;t<e.length;t++)this.traverser(e[t]);this.options.callback&&this.options.callback.call(this.$el)},traverser:function(t){var s,i=this;if(1===t.nodeType){if(t=t.firstChild)do{s=t.nextSibling,t.className!=this.options.replaceClass&&this.traverser(t)}while(t=s)}else if(3===t.nodeType){var n=document.createElement("div"),a=t.data,o=new RegExp("(?:^|\\b)("+this.cleanedTerms+")(?!\\w)",i.regexOption),l=new RegExp("(?:^|\\b)("+this.excludedTerms+")(?!\\w)",i.regexOption);if(o.test(a)){var c=l.exec(a);for(a=a.replace(o,function(e,t,s){if(i.options.replaceOnce&&r(e,i.replaced)>=0)return e;if(i.replaced.push(e),new RegExp("(?:^|\\b)"+i.clean(e)+"(?!\\w)").exec(a)){if(c&&i.excludes.length){var n=s,o=c.index,l=c.index+c[0].length;return o<=n&&n<=l?e:"<"+i.options.replaceTag+' class="'+i.options.replaceClass+'" title="'+i.getDescription(e)+'">'+e+"</"+i.options.replaceTag+">"}return"<"+i.options.replaceTag+' class="'+i.options.replaceClass+'" title="'+i.getDescription(e)+'">'+e+"</"+i.options.replaceTag+">"}}),e(n).html(a);n.firstChild;)t.parentNode.insertBefore(n.firstChild,t);t.parentNode.removeChild(t)}}}};var n={destroy:function(){this.$el.removeData("plugin_"+s),this.$el.find("."+this.options.replaceClass).each(function(){var t=e(this),r=t.text();t.replaceWith(r)})}};t.prototype=e.extend({},t.prototype,n),e.fn[s]=function(r){return this.each(function(){var i=e(this).data("plugin_"+s);"string"==typeof r&&i&&n.hasOwnProperty(r)?i[r].apply(i):(i&&i.destroy.apply(i),e.data(this,"plugin_"+s,new t(this,r)))})}});